{% extends 'base.html' %}

{% block title %}ã‚¢ãƒ‰ã‚ªãƒ³ä¸€è¦§ - ãƒã‚¤ãƒ³ã‚¯ãƒ©ãƒ•ãƒˆã‚¢ãƒ‰ã‚ªãƒ³ã‚º{% endblock %}

{% block content %}
<h1 style="margin-bottom: 30px;">ã‚¢ãƒ‰ã‚ªãƒ³ä¸€è¦§</h1>

<div class="search-bar">
    <form method="get" style="display: flex; gap: 10px; flex: 1;">
        <input type="text" name="q" placeholder="ã‚¢ãƒ‰ã‚ªãƒ³åã‚„ä½œæˆè€…ã§æ¤œç´¢..." value="{{ search_query }}" style="flex: 1;">
        <select name="type" style="min-width: 150px;">
            <option value="">ã™ã¹ã¦ã®ç¨®é¡</option>
            {% for value, label in addon_types %}
                <option value="{{ value }}" {% if value == current_type %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
        <select name="sort">
            <option value="-created_at">æœ€æ–°é †</option>
            <option value="-downloads">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ•°</option>
            <option value="name">åå‰é †</option>
        </select>
        <button type="submit">æ¤œç´¢</button>
    </form>
</div>

{% if addons %}
    <div class="addon-grid">
        {% for addon in addons %}
        <div class="addon-card">
            <div class="addon-card-image">
                {% if addon.thumbnail %}
                    <img src="{{ addon.thumbnail.url }}" alt="{{ addon.name }}">
                {% else %}
                    ğŸ“¦ {{ addon.get_addon_type_display }}
                {% endif %}
            </div>
            <div class="addon-card-content">
                <span class="addon-type">{{ addon.get_addon_type_display }}</span>
                <h3>{{ addon.name }}</h3>
                <p>{{ addon.description|truncatewords:15 }}</p>
                <div class="addon-meta">
                    <span>v{{ addon.version }}</span>
                    <span>â¬‡ï¸ {{ addon.downloads }}</span>
                </div>
                <div class="addon-footer">
                    <a href="{{ addon.get_absolute_url }}" class="button secondary">è©³ç´°</a>
                    <a href="{% url 'download_addon' addon.slug %}" class="button">DL</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    {% if is_paginated %}
    <div class="pagination">
        {% if page_obj.has_previous %}
            <a href="?page=1">æœ€åˆ</a>
            <a href="?page={{ page_obj.previous_page_number }}">â† å‰ã¸</a>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
                <span class="current">{{ num }}</span>
            {% else %}
                <a href="?page={{ num }}">{{ num }}</a>
            {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}">æ¬¡ã¸ â†’</a>
            <a href="?page={{ page_obj.paginator.num_pages }}">æœ€å¾Œ</a>
        {% endif %}
    </div>
    {% endif %}
{% else %}
    <div class="card" style="text-align: center; padding: 40px;">
        <p style="font-size: 16px; color: #999;">è©²å½“ã™ã‚‹ã‚¢ãƒ‰ã‚ªãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
        <a href="{% url 'addon_list' %}" class="button" style="margin-top: 15px;">æ¤œç´¢ã‚’ãƒªã‚»ãƒƒãƒˆ</a>
    </div>
{% endif %}
{% endblock %}
